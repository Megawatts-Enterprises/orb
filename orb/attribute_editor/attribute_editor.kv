#:import dp kivy.metrics.dp
#:import data_manager data_manager

########################################################################################
# ATTRIBUTE EDITOR
########################################################################################

<AEFees>:
    BoxLayout:
        orientation: 'vertical'
        height: dp(250)
        size_hint_y: None
        size_hint_x: None
        pos: root.pos
        width: root.width
        Label:
            text: "         "
        Label:
            text: "Fees:"
        MDTextField:
            text: str(root.fee_rate_milli_msat)
            helper_text: 'Fee Rate Milli Msat'
            helper_text_mode: "persistent"
            on_text_validate: root.fee_rate_milli_msat_changed(self.text)
        MDTextField:
            text: str(root.fee_base_msat)
            helper_text: 'Fee Base Msat'
            helper_text_mode: "persistent"
            on_text_validate: root.fee_base_msat_changed(self.text)
        MDTextField:
            text: str(root.min_htlc)
            helper_text: 'Min HTLC msat'
            helper_text_mode: "persistent"
            on_text_validate: root.min_htlc_changed(self.text)
        MDTextField:
            text: str(root.max_htlc_msat)
            helper_text: 'Max HTLC msat'
            helper_text_mode: "persistent"
            on_text_validate: root.max_htlc_msat_changed(self.text)
        MDTextField:
            text: str(root.time_lock_delta)
            helper_text: 'Time Lock Delta'
            helper_text_mode: "persistent"
            on_text_validate: root.time_lock_delta_changed(self.text)

<AEChannel@GridLayout>:
    cols: 1
    size_hint_y: None
    height: dp(2500)
    canvas.before:
        Color:
            rgba: .3, .3, .4, .1
        Rectangle:
            size: self.size
            pos: self.pos
    Label:
        text: '         '
    AEFees:
        channel: root.channel
        height: dp(250)
        size_hint_y: None
        size_hint_x: None
        width: root.width
    Label:
        text: "_________"
    Label:
        text: 'Pay through channel:'
    MDSwitch:
        pos_hint: {'center_x': .5, 'center_y': .5}
        active: data_manager.data_man.store.get('pay_through_channel', {}).get(str(root.channel.chan_id), True)
        on_active: root.pay_through_channel(self.active)
    Label:
        text: "_________"
    MDTextField:
        text: data_manager.data_man.store.get('balanced_ratio', {}).get(str(root.channel.chan_id), '0.5')
        helper_text: 'balanced ratio (local / capacity)'
        helper_text_mode: "persistent"
        on_text_validate: root.on_balanced_ratio(self.text)


<AttributeEditor>
    ScrollView:
        canvas.before:
            Color:
                rgba: 1, .3, .4, (0.1 * (app.config['debug']['layouts'] == '1'))
            Rectangle:
                size: self.size
                pos: self.pos
        id: ae_scroll_view
        size_hint: 1, 1
        pos_hint: {'center_x': .5, 'center_y': .5}
        do_scroll_x: False
        do_scroll_y: True
